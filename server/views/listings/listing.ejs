<!-- page to display listing information and calendar for rentals -->

<!DOCTYPE html>

<html>

	<head>
		<title>DomaHub - <%= listing_info.domain_name %></title>
		<%- include("../templates/head_links", {user: user});%>
		<link rel="stylesheet" href="/css/lib/fullcalendar.min.css" type="text/css" />
		<link rel="stylesheet" href="/css/listing_unique.css" type="text/css" />
	</head>

	<body>
		<%- include("../templates/navbar", {user: user}); %>

		<section id="background_image" class="section listing-section landing-img" style="background-image:url('<%= listing_info.background_image || 'https://source.unsplash.com/category/people' %>')">

		</section>

		<section id="top_wrapper" class="page_wrapper section is-small">
			<div class="container">
				<div class="columns">
					<div class="column is-half">
						<div class="content">
							<a class="primary-link" href="http://<%= listing_info.domain_name %>">
							<h1 class="title is-1 is-bold is-primary is-inline-block">
								<%= listing_info.domain_name %></h1></a>
							<p>
								<%= listing_info.description %>
							</p>
						</div>
						<div class="card is-fullwidth no-shadow">
							<div class="card-content">
								<article class="media">
									<figure class="media-left">
										<p class="image profile-image is-64x64">
										<% if (user){ %>
											<img src="<%= user.profile_pic %>">
										<% } else { %>
											<img src="https://placeholdit.imgix.net/~text?txtsize=30&bg=9e9e9e&txtclr=ffffff&txt=<%= listing_info.username %>&w=128&h=128">
										<% } %>
								    </p>
									</figure>
									<div class="media-content">
										<div class="content">
											<p class="is-primary"><%= listing_info.username %></p>
											<p class="is-blacklight">User since <span id='user-since'></span></p>
										</div>
									</div>
								</article>
							</div>
							<div class="card-footer">
								<a class="button card-footer-item no-shadow" href="/profile/inbox/<%= listing_info.username %>">
									<span class="icon is-small is-blacklight">
										<i class="fa fa-envelope"></i>
									</span>
									<span>Message</span>
								</a>
							</div>
						</div>
					</div>
					<div class="column is-2">

					</div>
					<div class="column">
						<div class="card">
							<div class="card-header no-shadow is-accent">
								<h2 class="card-header-title is-white has-text-centered">
									<% if (listing_info.status) { %>
									Available
									<% } else { %>
									Unavailable
									<% } %>
								</h2>
							</div>
							<div class="card-content">
								<div class="content">
									<canvas id="myChart"></canvas>
								</div>
							</div>
							<div class="card-footer">
								<% if (rental_info && typeof rental_info != undefined) { %>
									<a id="top_next_rental" class="next_button card-footer-item button is-primary">Add Times</a>
								<% } else { %>
									<a id="top_next" class="next_button card-footer-item button is-primary">Rent Now</a>
								<% } %>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<div id="calendar_wrapper" class="has-text-centered">

			<div id="calendar_top_wrapper">

				<div id="calendar_left_wrapper" class="info_wrapper_block">
					<div class="button" id="remove_events">Remove all</div>
					<div class="button" id="month_button">Month</div>
					<div class="button" id="prev-button"><</div>
					<div class="button" id="today-button">Today</div>
					<div class="button" id="next-button">></div>
				</div>

				<div id="calendar_right_wrapper" class="info_wrapper_block">
					<% if (listing_info.status) { %>
						<h1 id="price">$0</h1>
					<% } else {%>
						<h1 id="price">$?</h1>
					<% } %>
					<div class="button next_button" id="calendar_next">Next</div>
				</div>
			</div>

			<div id="calendar"></div>

		</div>


		<div id="address_wrapper" class="page_wrapper">

			<div class="info_wrapper">
				<h2 class="listing_info_text listing_info_text_white">Connect your website to <span class="green_text"><%= listing_info.domain_name %></span><h2>
				<input required class="input" id="address_form_input" type="url" placeholder="URL">
				<div class="button next_button" id="address_next">Next</div>
				<div id="faq_wrapper">
					<h3>Don&#39;t know how?</h3>
				</div>
			</div>

		</div>

		<div id="pay_wrapper" class="page_wrapper">

			<div class="info_wrapper">
				<form id="listing_form" action="/listing/<%=listing_info.domain_name%>/pay" method="post">
					<button class="form_submit button btn btn-primary btn-lg" id="stripe-button">
						Checkout <span class="glyphicon glyphicon-shopping-cart"></span>
					</button>
				</form>
			</div>

		</div>

		<%- include("../templates/footer"); %>
		<%- include("../templates/js_scripts"); %>
		<script src="https://checkout.stripe.com/checkout.js"></script>
		<script src="/js/lib/moment.min.js" type="text/javascript"></script>
		<script src="/js/lib/fullcalendar.min.js" type="text/javascript"></script>
		<script src="/js/lib/chart.min.js" type="text/javascript"></script>
		<script type="text/javascript">
			var listing_message = <% if(typeof listing_message != "undefined"){ %><%-JSON.stringify(listing_message)%><% }else{ %>""<% } %>;
			var listing_info = <% if(typeof listing_info != "undefined"){ %><%-JSON.stringify(listing_info)%><% }else{ %>""<% } %>;
			var new_rental_info = <% if(typeof new_rental_info != "undefined"){ %><%-JSON.stringify(new_rental_info)%><% }else{ %>""<% } %>;
			var rental_info = <% if(typeof rental_info != "undefined"){ %><%-JSON.stringify(rental_info)%><% }else{ %>""<% } %>;
			var whoisObj = <% if(typeof whoisObj != "undefined"){ %><%-JSON.stringify(whoisObj)%><% }else{ %>""<% } %>;
		</script>
		<script src="/js/routes/calendar/calendar_listed_logic.js" type="text/javascript"></script>
		<script src="/js/routes/calendar/calendar_general_logic.js" type="text/javascript"></script>
		<script src="/js/routes/listings/listing_listed_logic.js" type="text/javascript"></script>

	</body>

</html>
