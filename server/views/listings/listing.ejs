<!-- page to display listing information and calendar for rentals -->

<!DOCTYPE html>

<html>

	<head>
		<title>DomaHub</title>
		<%- include("../templates/head_links"); %>
		<link rel="stylesheet" href="/css/lib/fullcalendar.min.css" type="text/css" />
		<link rel="stylesheet" href="/css/listing_unique.css" type="text/css" />
	</head>

	<body>
		<%- include("../templates/navbar", {user: user}); %>

		<section id="listing-img" class="section listing-section landing-img">

		</section>

		<section class="section is-medium">
			<div class="container">
				<div class="columns">
					<div class="column is-half">
						<div class="content">
							<a href="http://<%= listing_info.domain_name %>">
							<h1 class="title is-1 is-bold is-primary is-inline-block">
							<%= listing_info.domain_name %></h1></a>
							<p>
								<%= listing_info.description %>
							</p>
						</div>
						<span class="tag is-primary is-large margin-bottom-50 is-uppercase">
							<% if (listing_info.status) { %>
							Available
							<% } else { %>
							Unavailable
							<% } %>
						</span>
						<% if (listing_info.status) { %>
						<div class="content">
							<h3 class="is-bold is-blacklight is-underlined">Rates</h3>
							<p>Hourly&#58; &#36;<%=listing_info.hour_price%></p>
							<p>Daily&#58; &#36;<%=listing_info.day_price%></p>
							<p>Weekly&#58; &#36;<%=listing_info.week_price%></p>
							<p>Monthly&#58; &#36;<%=listing_info.month_price%></p>
						</div>
						<% } %>
					</div>
					<div class="column is-1">

					</div>
					<div class="column">
						<article class="media">
							<figure class="media-left">
								<p class="image profile-image is-64x64">
						      <img src="http://placehold.it/128x128">
						    </p>
							</figure>
							<div class="media-content">
								<div class="content">
									<a href="/profile/inbox/<%= listing_info.username %>">
									<h2 class="is-bold is-primary is-inline-block"><%= listing_info.username %></h2>
									</a>
									<p>
										Contact
									</p>
								</div>
							</div>
						</article>

					</div>
				</div>
			</div>
		</section>

		<div id="top_wrapper" class="page_wrapper">
			<div id="image_wrapper">
				<img id="background_image" class="background_image noselect" width="100%" height="100%" src="<%= listing_info.background_image || 'https://source.unsplash.com/category/people' %>">
			</div>
			<div class="info_wrapper">

				<div id="listing_info_wrapper">
					<!-- information about the current listing -->
					<div id="listing_info_title" class="listing_info_center">
						<h2 class="listing_info_text"><a href="http://<%= listing_info.domain_name %>" class="green_text"><%= listing_info.domain_name %></a></h2>
						<p id="domain_owner" class="listing_info_text listing_info_text_white">Owned by: <a class="green_text" href="/profile/inbox/<%= listing_info.username %>"><%= listing_info.username %></a></p>
						<% if (listing_info.status) { %>
							<div id="pricing_wrapper">
								<p class="listing_info_text listing_info_text_white">Hour <span class="green_text">$<%=listing_info.hour_price%></span> | </p>
								<p class="listing_info_text listing_info_text_white">Day <span class="green_text">$<%=listing_info.day_price%></span> | </p>
								<p class="listing_info_text listing_info_text_white">Week <span class="green_text">$<%=listing_info.week_price%></span> | </p>
								<p class="listing_info_text listing_info_text_white">Month <span class="green_text">$<%=listing_info.month_price%></span></p>
							</div>
						<% } %>
					</div>

					<% if (rental_info && typeof rental_info != undefined) { %>
						<div id="domain_description" class="rental_hide">
							<div id="rental_times">Rented from:</div>
						</div>
					<% } else {%>
						<p id="domain_description" class="default_hide"><%= listing_info.description %></p>
					<% } %>

					<% if (listing_info.buy_link != null && listing_info.buy_link.length > 0) { %>
						<p id="buy_link" class="listing_info_margin_top listing_info_center"><a class="orange-link" href="<%= listing_info.buy_link %>">Interested in buying this domain?</a></p>
					<% } %>
				</div>

				<div id="start_form_wrapper" class="listing_info_margin_top">
					<% if (available == 3 || available == 2){ %>
						<% if (rental_info && typeof rental_info != undefined) { %>
							<div class="button next_button rental_hide" id="top_next_rental">Add times</div>
							<div class="button next_button rental_hide" id="calendar_next_rental">Edit website</div>
						<% } else {%>
							<div class="button is-primary next_button default_hide" id="top_next">Get started</div>
						<% } %>
					<% } else { %>
						<a id="godaddy_link" class="button" href="https://www.godaddy.com/domains/searchresults.aspx?domainToCheck=">GoDaddy</a>
						<a id="namecheap_link" class="button" href="https://www.namecheap.com/domains/registration/results.aspx?domain=">Namecheap</a>
						<a id="google_link" class="button" href="https://domains.google.com/registrar?s=">Google Domains</a>
					<% } %>
				</div>

			</div>

		</div>

		<% if (available == 3 || available == 2) { %>

			<div id="calendar_wrapper" class="has-text-centered">

				<div id="calendar_top_wrapper">
					<div id="calendar_price_wrapper">
						<% if (listing_info.status) { %>
							<p class="listing_info_text">Hour <span class="green_text">$<%=listing_info.hour_price%></span> | </p>
							<p class="listing_info_text">Day <span class="green_text">$<%=listing_info.day_price%></span> | </p>
							<p class="listing_info_text">Week <span class="green_text">$<%=listing_info.week_price%></span> | </p>
							<p class="listing_info_text">Month <span class="green_text">$<%=listing_info.month_price%></span></p>
						<% } %>
					</div>

					<div id="calendar_left_wrapper" class="info_wrapper_block">
						<div class="button" id="remove_events">Remove all</div>
						<div class="button" id="month_button">Month</div>
						<div class="button" id="prev-button"><</div>
						<div class="button" id="today-button">Today</div>
						<div class="button" id="next-button">></div>
					</div>

					<div id="calendar_right_wrapper" class="info_wrapper_block">
						<% if (listing_info.status) { %>
							<h1 id="price">$0</h1>
						<% } else {%>
							<h1 id="price">$?</h1>
						<% } %>
						<div class="button next_button" id="calendar_next">Next</div>
					</div>
				</div>

				<!-- any messages from the server
				<div id="listing_message">
					<% if (typeof listing_message != "undefined") {%>
						<%= listing_message %>
					<% } else {%>
						&nbsp;
					<% } %>
				</div>-->

				<div id="calendar"></div>

			</div>

		<% } %>

		<% if (available == 3) { %>

			<div id="address_wrapper" class="page_wrapper">

				<div class="info_wrapper">
					<h2 class="listing_info_text listing_info_text_white">Connect your website to <span class="green_text"><%= listing_info.domain_name %></span><h2>
					<input required class="input" id="address_form_input" type="url" placeholder="URL">
					<div class="button next_button" id="address_next">Next</div>
					<div id="faq_wrapper">
						<h3>Don&#39;t know how?</h3>
					</div>
				</div>

			</div>

			<div id="pay_wrapper" class="page_wrapper">

				<div class="info_wrapper">
					<form id="listing_form" action="/listing/<%=listing_info.domain_name%>/pay" method="post">
						<button class="form_submit button btn btn-primary btn-lg" id="stripe-button">
							Checkout <span class="glyphicon glyphicon-shopping-cart"></span>
						</button>
					</form>
				</div>

			</div>

		<% } %>

		<%- include("../templates/footer"); %>
		<%- include("../templates/js_scripts"); %>
		<script src="https://checkout.stripe.com/checkout.js"></script>
		<script src="/js/lib/moment.min.js" type="text/javascript"></script>
		<script src="/js/lib/fullcalendar.min.js" type="text/javascript"></script>
		<script type="text/javascript">
			var listing_message = <% if(typeof listing_message != "undefined"){ %><%-JSON.stringify(listing_message)%><% }else{ %>""<% } %>;
			var listing_info = <% if(typeof listing_info != "undefined"){ %><%-JSON.stringify(listing_info)%><% }else{ %>""<% } %>;
			var new_rental_info = <% if(typeof new_rental_info != "undefined"){ %><%-JSON.stringify(new_rental_info)%><% }else{ %>""<% } %>;
			var rental_info = <% if(typeof rental_info != "undefined"){ %><%-JSON.stringify(rental_info)%><% }else{ %>""<% } %>;
			var whoisObj = <% if(typeof whoisObj != "undefined"){ %><%-JSON.stringify(whoisObj)%><% }else{ %>""<% } %>;
			var available = <% if(typeof available != "undefined"){ %><%-JSON.stringify(available)%><% }else{ %>""<% } %>;
		</script>
		<script src="/js/routes/calendar/calendar_listed_logic.js" type="text/javascript"></script>
		<script src="/js/routes/calendar/calendar_general_logic.js" type="text/javascript"></script>
		<script src="/js/routes/listings/listing_listed_logic.js" type="text/javascript"></script>

	</body>

</html>
