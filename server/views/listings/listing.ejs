<!-- page to display listing information and calendar for rentals -->

<!DOCTYPE html>

<html>

	<head>
		<title>DomaHub - <%= listing_info.domain_name %></title>
		<%- include("../templates/head_links", {user: user});%>
		<link rel="stylesheet" href="/css/lib/fullcalendar.min.css" type="text/css" />
		<link rel="stylesheet" href="/css/listing_unique.css" type="text/css" />
	</head>

	<body>
		<%- include("../templates/navbar", {user: user}); %>

		<section id="background_image" class="section listing-section landing-img" style="background-image:url('<%= listing_info.background_image || 'https://source.unsplash.com/category/nature' %>')">

		</section>

		<section id="top_wrapper" class="page_wrapper section is-small has-borderBottom">
			<div class="container">
				<div class="columns">
					<div class="column is-half">
						<div class="content">
							<a class="primary-link" href="http://<%= listing_info.domain_name %>">
							<h1 class="title is-1 is-bold is-primary is-inline-block">
							<%= listing_info.domain_name %></h1></a>
						</div>
						<div class="content is-marginless">
							<% if (listing_info.status == 1) { %>
							<span class="tag is-medium is-primary">Available</span>
							<% } else { %>
							<span class="tag is-medium is-danger">Unavailable</span>
							<% } %>
						</div>
						<div class="listing-info-wrapper">
							<div class="content">
								<h3 class="is-bold">Listing Description</h3>
								<p>
									<%= listing_info.description %>
								</p>
							</div>
						</div>
						<div class="listing-info-wrapper is-hidden-mobile">
							<div class="content">
								<h3 class="is-bold">Other Information</h3>
							</div>
						<% if (listing_info.buy_link) { %>
						<div class="columns has-borderBottom">
							<div class="column is-4">
								<div class="content">
									<p class="is-blacklight is-bold">
										Purchase Link
									</p>
								</div>
							</div>
							<div class="column is-4">
								<div class="content">
									<a class="orange-link"><%= listing_info.buy_link %></a>
								</div>
							</div>
						</div>
						<% } %>
						<div class="columns has-borderBottom">
							<div class="column is-4">
								<div class="content">
									<p class="is-blacklight is-bold">
										Date Created
									</p>
								</div>
							</div>
							<div class="column is-4">
								<div class="content">
									<p id="date_created"></p>
								</div>
							</div>
						</div>
						<% if (listing_info.categories) { %>
							<div class="columns has-borderBottom">
								<div class="column is-4">
									<div class="content">
										<p class="is-blacklight is-bold">
											Categories
										</p>
									</div>
								</div>
								<div class="column is-8">
									<div class="content">
										<p>
											<% var categories_array = listing_info.categories.split(" ");
												var display_array = [];
												for (var i = 0; i < categories_array.length; i++) {
													 display_array.push(categories_array[i].charAt(0).toUpperCase() + categories_array[i].substr(1)); %>
											<% } %>
											<%= display_array.join(", ") %>
											</p>
										</div>
									</div>
								</div>
								<% } %>
						</div>
						<div class="listing-info-wrapper is-hidden-mobile">
							<div class="content margin-top-25">
								<h3 class="is-bold">About Owner</h3>
							</div>
							<div class="columns">
								<div class="column">
									<article class="media">
									  <figure class="media-left">
									    <p class="image is-circle is-96x96">
												<% if (listing_info.profile_pic){ %>
													<img src="<%= listing_info.profile_pic %>">
												<% } else { %>
													<%- "<img src='https://placeholdit.imgix.net/~text?txtsize=25&bg=9e9e9e&txtclr=ffffff&txt=" + listing_info.username + "&w=128&h=128'/>" %>
												<% } %>
									    </p>
									  </figure>
									  <div class="media-content">
									    <div class="content">
												<h3 class="is-blacklight is-bold"><%= listing_info.username %></h3>
									      <p>
													<small>User since <span id='user-since'></span></small>
									      </p>
									    </div>
											<p class="control">
											  <a href="/profile/messages/<%=listing_info.username %>" class="button is-primary no-shadow">
											    <span class="icon is-small">
											      <i class="fa fa-envelope"></i>
											    </span>
											    <span>Message</span>
											  </a>
											</p>
									  </div>
									</article>
								</div>
							</div>
						</div>
					</div>

					<div class="column is-2"></div>

					<div class="column is-4">
						<div class="card">
							<% if (listing_info.status == 1) { %>
							<div class="card-header is-light">
								<h2 class="is-bold card-header-title">$<%= listing_info.month_price %></h2>
								<p class="card-header-title jc-flex-end is-marginless">Per Month</p>
							</div>
							<% } %>
							<div class="card-content">
								<div class="content">
									<% if (listing_info.status == 1) { %>
									<p class="is-bold">Pricing Information</p>
									<nav class="level is-mobile has-borderBottom">
										<div class="level-left">
											<p class="level-item">
												Hourly:
											</p>
										</div>
										<div class="level-right">
											<p class="level-item">
												$<%= listing_info.hour_price %>
											</p>
										</div>
									</nav>
									<nav class="level is-mobile has-borderBottom">
										<div class="level-left">
											<p class="level-item">
												Daily:
											</p>
										</div>
										<div class="level-right">
											<p class="level-item">
												$<%= listing_info.day_price %>
											</p>
										</div>
									</nav>
									<nav class="level is-mobile has-borderBottom">
										<div class="level-left">
											<p class="level-item">
												Weekly:
											</p>
										</div>
										<div class="level-right">
											<p class="level-item">
												$<%= listing_info.week_price %>
											</p>
										</div>
									</nav>
									<nav class="level is-mobile has-borderBottom">
										<div class="level-left">
											<p class="level-item">
												Monthly:
											</p>
										</div>
										<div class="level-right">
											<p class="level-item">
												$<%= listing_info.month_price %>
											</p>
										</div>
									</nav>
									<% } else { %>
									<p>
										This domain is currently unavailable. You may request
										the listing by clicking the button below which will
										notify both DomaHub and the domain owner.
									</p>
									<% } %>
								</div>
							</div>
							<div class="card-footer">
								<% if (listing_info.status == 1) { %>
								<a id="listing-modal-button" class="card-footer-item button is-primary" data-object="#calendar-modal">Check Availability</a>
								<% } else { %>
								<a class="card-footer-item button is-primary">Request Listing</a>
								<% } %>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<div id="listing-modal" class="modal">
			<div class="modal-background"></div>
			<div class="modal-container-calendar">
				<div id="calendar-modal-content" class="modal-content listing-calendar">
					<nav class="level">
						<div class="level-left">
							<div class="level-item">
								<a class="button is-danger no-shadow" id="remove_events">Remove Selected</a>
							</div>
							<div class="level-item">
								<a class="button no-shadow" id="month_button">Month View</a>
							</div>
							<div class="level-item">
								<a class="button no-shadow" id="today-button">Today</a>
							</div>
						</div>
						<div class="level-right">
							<div class="level-item">
								<a id="redirect-next-button" class="button no-shadow is-primary is-disabled">Next</a>
							</div>
						</div>
					</nav>
					<div id="price-ticker" class="has-text-centered">
						<h1 id="price">$0</h1>
					</div>
				</div>
				<div id="redirect-modal-content" class="modal-content listing-redirect is-hidden">

				</div>
			</div>
			<button class="modal-close"></button>
		</div>

		<%# keep calendar outside of modal and move it in with JS to fix weird bug of not appearing%>
		<div id="calendar"></div>

<!--
		<div id="address_wrapper" class="page_wrapper">

			<div class="info_wrapper">
				<h2 class="listing_info_text listing_info_text_white">Connect your website to <span class="green_text"><%= listing_info.domain_name %></span><h2>
				<input required class="input" id="address_form_input" type="url" placeholder="URL">
				<div class="button next_button" id="address_next">Next</div>
				<div id="faq_wrapper">
					<h3>Don&#39;t know how?</h3>
				</div>
			</div>

		</div>

		<div id="pay_wrapper" class="page_wrapper">

			<div class="info_wrapper">
				<form id="listing_form" action="/listing/<%=listing_info.domain_name%>/pay" method="post">
					<button class="form_submit button btn btn-primary btn-lg" id="stripe-button">
						Checkout <span class="glyphicon glyphicon-shopping-cart"></span>
					</button>
				</form>
			</div>

		</div> -->

		<%- include("../templates/footer"); %>
		<%- include("../templates/js_scripts"); %>
		<script src="https://checkout.stripe.com/checkout.js"></script>
		<script src="/js/lib/moment.min.js" type="text/javascript"></script>
		<script src="/js/lib/fullcalendar.min.js" type="text/javascript"></script>
		<script src="/js/lib/wNumb.js" type="text/javascript"></script>
		<script type="text/javascript">
			var listing_message = <% if(typeof listing_message != "undefined"){ %><%-JSON.stringify(listing_message)%><% }else{ %>""<% } %>;
			var listing_info = <% if(typeof listing_info != "undefined"){ %><%-JSON.stringify(listing_info)%><% }else{ %>""<% } %>;
			var new_rental_info = <% if(typeof new_rental_info != "undefined"){ %><%-JSON.stringify(new_rental_info)%><% }else{ %>""<% } %>;
			var rental_info = <% if(typeof rental_info != "undefined"){ %><%-JSON.stringify(rental_info)%><% }else{ %>""<% } %>;
		</script>
		<script src="/js/routes/calendar/calendar_listed_logic.js" type="text/javascript"></script>
		<script src="/js/routes/calendar/calendar_general_logic.js" type="text/javascript"></script>
		<script src="/js/routes/listings/listing_listed_logic.js" type="text/javascript"></script>
		<script src="/js/routes/listings/listing_general_logic.js" type="text/javascript"></script>

	</body>

</html>
