<section id="background_image" class="section listing-section landing-img" style="background-image:url('<%= listing_info.background_image || 'https://source.unsplash.com/category/nature/800x600' %>')">
  <div class="img-wrapper">
    <div id="listing-hero" class="container">
      <div>

      </div>
      <div class="content has-text-centered">
        <a tabindex="1" href="http://<%= listing_info.domain_name %>">
        <h1 id="domain-display" class="title is-1 is-bold is-primary is-inline-block">
        <%= listing_info.domain_name %></h1></a>
        <h2 class="subtitle is-4 is-white margin-top-15">
        <% if (listing_info.status == 1) { %>
          Currently Available
          <% } else { %>
          Currently Unavailable
          <% } %>
        </h2>
      </div>
      <div id="price-display-column" class="columns margin-right-0">
        <div class="column is-4-tablet is-offset-8-tablet">
          <div id="price-display">
            <h2 id="price" class="is-black is-bold has-text-centered">
              <% if (listing_info.status == 1) { %>
                  $<%= listing_info.price_rate %> Per <%= listing_info.price_type.charAt(0).toUpperCase() + listing_info.price_type.substr(1) %>
              <% } else if (listing_info.available){ %>
                  Available for Purchase
              <% } else { %>
                  Request Listing
              <% } %>
            </h2>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="top-wrapper" class="min-height">
  <div class="container">
    <div class="columns flex-column-mobile margin-right-0">
      <div class="column is-8 order-2-mobile">

      <% if (listing_info.rentals.length > 0){ %>
          <% var popular_rental; %>
          <% for (var x = 0; x < listing_info.rentals.length; x++){ %>
              <% var max_views = 0;
              if (listing_info.rentals[x].views > max_views){
                  popular_rental = listing_info.rentals[x];
              } %>
          <% } %>
          <% var background_image = (popular_rental.address == "") ? "https://placeholdit.imgix.net/~text?txtsize=20&txt=NO%20PREVIEW&w=800&h=400" : "/screenshot?rental_address=" + popular_rental.address; %>
          <% background_image = (popular_rental.address.match(/\.(jpeg|jpg|gif|png)$/) != null) ? popular_rental.address : background_image; %>
        <div id="popular-rental-module" data-rental_id="<%= popular_rental.rental_id %>" class="listing-module">
          <div class="content margin-bottom-25">
            <h2>Trending Rental</h2>
          </div>
          <div class="card is-fullwidth no-shadow">
            <div class="card-image">
              <figure class="image">
                <img id="popular-rental-img" src="<%= background_image %>" alt="Image">
              </figure>
            </div>
            <div class="card-content">
              <nav class="level">
                <div class="level-left">
                  <div class="content level-item">
                    <h3 id="popular-rental-duration" class="is-bold"></h3>
                    <p id="popular-rental-views"><%= popular_rental.views %> Views</p>
                  </div>
                </div>
                <div class="level-right">
                  <a  target="_blank" id="popular-rental-preview" href="/listing/<%= listing_info.domain_name + '/' + popular_rental.rental_id %>" class="button is-primary level-item">
                    <span>View</span>
                    <span class="icon is-small">
                      <i class="fa fa-external-link-square"></i>
                    </span>
                  </a>
                </div>
              </nav>
            </div>
          </div>
        </div>

        <% if (listing_info.rentals.length > 1) { %>
            <div id="previous-listings-table" class="listing-module">
              <div class="content margin-bottom-25">
                <h2>Latest Rentals</h2>
              </div>
              <div id="previous-listing-clone" class="is-hidden previous-listing">
                  <div class="previous-stats">
                      <h3 class="previous-listing-title">
                        <span class='previous-rental-duration'></span> · <span class='previous-rental-views'></span> Views
                      </h3>
                      <a target="_blank" class="button is-primary is-inverted">
                          <span>View</span>
                          <span class="icon is-small">
                            <i class="fa fa-external-link-square"></i>
                          </span>
                      </a>
                  </div>
              </div>
              <% var existing_array = [popular_rental.rental_id] %>
              <% var index_counter = listing_info.rentals.length; %>

              <%# TOTAL NUMBER OF LATEST RENTALS TO SHOW %>
              <% var total_existing = 5; %>

              <% for (var x = 0; x < Math.min(listing_info.rentals.length, total_existing); x++){ %>
                  <% index_counter-- %>
                  <% if (existing_array.indexOf(listing_info.rentals[index_counter].rental_id) == -1) { %>
                      <% var temp_rental = listing_info.rentals[index_counter]; %>
                      <% var temp_background = (temp_rental.address == "") ? "https://placeholdit.imgix.net/~text?txtsize=40&txt=NO%20PREVIEW&w=800&h=100" : "/screenshot?rental_address=" + temp_rental.address + "&width=700&height=100"; %>
                      <% temp_background = (temp_rental.address.match(/\.(jpeg|jpg|gif|png)$/) != null) ? temp_rental.address : temp_background; %>
                      <div class="previous-listing">
                         <!-- style="background-image: url(<%= temp_background %>)" -->
                          <div class="previous-stats">
                              <h3 class="previous-listing-title">
                                <span data-rental_id="<%= temp_rental.rental_id %>" class='previous-rental-duration'></span> · <%= temp_rental.views %> Views
                              </h3>
                              <a target="_blank" href="/listing/<%= listing_info.domain_name + '/' + temp_rental.rental_id%>" class="button is-primary is-inverted">
                                  <span>View</span>
                                  <span class="icon is-small">
                                    <i class="fa fa-external-link-square"></i>
                                  </span>
                              </a>
                          </div>
                      </div>
                      <% existing_array.push(temp_rental.rental_id) %>
                  <% } else { %>
                      <% total_existing++ %>
                  <% } %>
              <% } %>
            </div>
        <% } %>

        <% } %>
        <div id="similar-domains" class="is-hidden listing-module">
          <div class="content margin-bottom-25">
            <h2 id="similar-domains-title">Other Domains</h2>
          </div>
          <div id="similar-domain-table" class="columns">
            <div id="similar-domain-clone" class="is-hidden column is-4">
              <div class="similar-domain-box">
                <h3>
                  <a class="similar-domain-name is-accent"></a>
                </h3>
                <p class="similar-domain-price is-bold"></p>
                <p class="similar-domain-available">Now available!</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="column is-4 order-1-mobile">
        <div id="checkout-card" class="card">
          <div class="card-content">
            <div class="content">
              <% if (listing_info.status == 1) { %>
                    <div class='checkout-card-content'>
                        <div class="content">
                            <p>
                                Click the button below to see available rental dates.
                            </p>
                        </div>
                        <a id="start-card-button" tabindex="1" class="card-button-next button is-medium is-fullwidth is-primary">Rent Now</a>
                    </div>

                    <div id="calendar-card-content" class="is-hidden checkout-card-content">
                        <div class="content">
                            <p>Choose your desired rental time slot.</p>
                            <p id="calendar-error-message"></p>
                        </div>
                        <div id="calendar" class=""></div>
                        <div class="margin-top-15 level-item">
                            <a tabindex="1" class="button is-danger is-disabled no-shadow" id="remove_events">Clear</a>
                            <a tabindex="1" class="button no-shadow is-disabled" id="today-button">Today</a>
                            <a tabindex="1" class="button no-shadow" id="next-available-button">Next Available</a>
                        </div>
                        <a tabindex="1" class="card-button-next button is-fullwidth is-primary margin-top-15">Next</a>
                    </div>

                    <div id="address-card-content" class="is-hidden checkout-card-content">
                        <div class="content">
                            <p>
                                The content in this link will be displayed to everyone viewing this domain during your rental time slot.
                            </p>
                            <p>
                                You may change this URL at any time with your DomaHub account.
                            </p>
                            <p id="address-error-message"></p>
                        </div>
                        <p class="control">
                            <input tabindex="1" autofocus required class="input is-medium" id="address_form_input" type="url" placeholder="Enter a link to your content">
                        </p>
                        <p class="control margin-top-15">
                            <a tabindex="1" class="card-button-prev button">Back</a>
                            <a tabindex="1" class="card-button-next button is-primary">Checkout</a>
                        </p>
                    </div>

                    <% if (!user){ %>
                        <div id="nouser-card-content" class="is-hidden checkout-card-content">
                            <p>
                                You are currently checking out as a guest.
                            </p>
                            <p>
                                You may optionally enter your email below to create a DomaHub account afterwards to edit your rental.
                            </p>
                            <p class='is-accent'>
                                NOTE: You cannot edit this rental after purchase without a DomaHub account.
                            </p>
                            <form>
                                <label id="new-user-email-error" class="label">Email Address</label>
                                <p class="control has-icon has-addons">
                                    <input tabindex="1" id="new_user_email" class="input is-medium" placeholder="This is optional" type="email" />
                                    <i class="fa fa-envelope"></i>
                                </p>
                            </form>
                            <p class="control margin-top-15">
                                <a tabindex="1" class="card-button-prev button">Back</a>
                                <a tabindex="1" class="card-button-next button is-primary">Checkout</a>
                            </p>
                        </div>
                    <% } %>

                    <div id="checkout-card-content" class="success-hide is-hidden checkout-card-content">
                        <div class="content">
                            <p id="stripe-error-message">
                                Please enter your payment information.
                            </p>
                        </div>
                        <form id="stripe-form" autocomplete="on">
                            <label class="label">Credit or Debit Card Number</label>
                            <p class="control has-icon">
                                <input tabindex="1" id="cc-num" data-stripe="number" class="input stripe-input is-medium" type="tel" placeholder="•••• •••• •••• ••••" autocomplete="cc-number"/>
                                <i id="cc-icon" class="fa fa-credit-card"></i>
                            </p>
                            <div class="control is-grouped">
                                <p class="control is-expanded">
                                    <label class="label">Expiration Date</label>
                                    <input tabindex="1" id="cc-exp" maxlength="7" data-stripe="exp" class="input stripe-input is-medium" type="tel" placeholder="•• / ••" autocomplete="cc-exp"/>
                                </p>
                                <p class="control">
                                    <label class="label">Security Code</label>
                                    <input tabindex="1" id="cc-cvc" data-stripe="cvc" class="input stripe-input is-medium" type="tel" placeholder="•••" autocomplete="off"/>
                                </p>
                            </div>
                            <p class="control">
                                <label class="label">Zip Code</label>
                                <input tabindex="1" id="cc-zip" maxlength="6" data-stripe="address_zip" class="input stripe-input is-medium" type="tel" autocomplete="postal-code" placeholder="•••••"/>
                            </p>
                        </form>
                        <form class="checkbox-form margin-top-10">
                            <input class="is-small" value="agree-to-terms" id="agree-to-terms" type="checkbox" />
                            <label class="is-small" tabindex="1" for="agree-to-terms">
                                I agree to the <a target="_blank" href="/terms" class="is-accent">DomaHub Terms & Conditions</a>.
                            </label>
                        </form>
                        <p class='control margin-top-15'>
                            <a tabindex="1" class="card-button-prev button">Back</a>
                            <a id="checkout-button" tabindex="1" class="button is-primary">Confirm & Pay</a>
                        </p>
                    </div>

                    <div id="success-column" class="is-hidden checkout-card-content">
                        <div class="notification is-primary">
                            <h2 class="is-white has-text-centered">Rental Successful!</h2>
                        </div>
                        <div class="content">
                            <p>
                                Your content will automatically display on
                                <a class="is-primary" href="http://<%= listing_info.domain_name %>"><%= listing_info.domain_name %></a>
                                at the below rental time(s).
                            </p>
                            <div class="columns">
                                <div class="column is-half">
                                    <div class="content">
                                        <p id="preview-start-dates" class="is-bold">
                                            Rental Start
                                        </p>
                                    </div>
                                </div>
                                <div class="column is-half">
                                    <div class="content">
                                        <p id="preview-end-dates" class="is-bold">
                                            Rental End
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <% if (!user) { %>
                                <h3 class="is-bold">Create an Account</h3>
                                <p>
                                    You will need to sign up for a new DomaHub account in order to edit any existing rentals.
                                </p>
                                <p>
                                    The below link is unique and can be used to associate this rental with a new DomaHub account.
                                    The link has also been emailed to you if you provided us with an email during checkout.
                                </p>
                                <div class="control has-addons">
                                    <input id="rental-link-input" class='input is-expanded' placeholder="Save me for later!"/>
                                    <a id="rental-link-button" class="button is-primary no-shadow">
                                        <i class="fa fa-clipboard"></i>
                                    </a>
                                </div>
                            <% } else { %>
                                <h3 class="is-bold">My Account</h3>
                                <p>
                                Should you need to edit the rental content or add more time, please click the
                                button below to go to your My Rentals page.
                                </p>
                                <p class="control margin-top-20">
                                    <a href="/profile/myrentals" class="button is-accent is-medium" tabindex="1">
                                        <span class="icon is-small">
                                            <i class="fa fa-th-list"></i>
                                        </span>
                                        <span>My Rentals</span>
                                    </a>
                                </p>
                            <% } %>
                        </div>
                    </div>

              <% } else if (listing_info.available) { %>
                <p>
                    While this domain is unavailable for rent at DomaHub,
                    it is available for purchase at any of the sites listed below.
                </p>
                <p>
                    Purchase it today for your own use or list it with us to
                    make some money!
                </p>
              <% } else { %>
                <p>
                    This domain is currently unavailable. You may request
                    the listing by clicking the button below which will
                    notify both DomaHub and the domain owner.
                </p>
              <% } %>
            </div>
          </div>
          <footer class="card-footer">
            <% if (listing_info.status == 1) { %>
              <a id="more-info-button" tabindex="1" class="card-footer-item no-border has-icon">
                <span>Show Listing Details</span>
                <span class="icon is-small">
                  <i class="fa fa-angle-down"></i>
                </span>
              </a>
              <a id="less-info-button" tabindex="1" class="card-footer-item has-icon is-hidden">
                <span>Hide Listing Details</span>
                <span class="icon is-small">
                  <i class="fa fa-angle-up"></i>
                </span>
              </a>
                <!-- <a tabindex="1" class="card-footer-item has-icon">
                  <span class="icon is-small">
                    <i class="fa fa-bookmark"></i>
                  </span>
                  <span>Save</span>
                </a>
                <a tabindex="1" class="card-footer-item has-icon">
                  <span class="icon is-small">
                    <i class="fa fa-flag"></i>
                  </span>
                  <span>Report</span>
                </a>
                <a tabindex="1" class="card-footer-item has-icon">
                  <span class="icon is-small">
                    <i class="fa fa-share-alt"></i>
                  </span>
                  <span>Share</span>
                </a> -->
            <% } else if (listing_info.available) { %>
              <a id="google_link" tabindex="1" class="card-footer-item" href="https://domains.google.com/registrar?s=<%= listing_info.domain_name %>">Google</a>
              <a id="namecheap_link" tabindex="1" class="card-footer-item" href="https://www.namecheap.com/domains/registration/results.aspx?domain=<%= listing_info.domain_name %>&aff=108189">Namecheap</a>
              <a id="godaddy_link" tabindex="1" class="card-footer-item" href="https://www.godaddy.com/domains/searchresults.aspx?domainToCheck=<%= listing_info.domain_name %>">GoDaddy</a>
            <% } else { %>
              <a id="request_link" class="button card-footer-item is-fullwidth is-primary" tabindex="1">Request Listing</a>
            <% } %>
          </footer>
        </div>
        <div id="description-card" class="card margin-bottom-25 is-hidden">
          <div class="card-content">
            <% if (listing_info.description) { %>
            <div class="content listing-info">
              <h3 class="is-bold margin-bottom-15">Description</h3>
              <p>
                <%= listing_info.description %>
              </p>
            </div>
            <% } %>
            <div class="content listing-info">
              <nav class="level">
                <div class="level-left">
                  <p class="level-item">Alexa Ranking</p>
                </div>
                <div class="level-right">
                  <p class="level-item is-bold"><%= listing_info.alexa.globalRank || "-" %></p>
                </div>
              </nav>
              <nav class="level">
                <div class="level-left">
                  <p class="level-item">Daily Time on Site</p>
                </div>
                <div class="level-right">
                  <p class="level-item is-bold"><%= listing_info.alexa.engagement.dailyTimeOnSite || "-" %></p>
                </div>
              </nav>
              <nav class="level">
                <div class="level-left">
                  <p class="level-item">Daily Pageviews per Visitor</p>
                </div>
                <div class="level-right">
                  <p class="level-item is-bold"><%= listing_info.alexa.engagement.dailyPageViewPerVisitor || "-" %></p>
                </div>
              </nav>
              <nav class="level">
                <div class="level-left">
                  <p class="level-item">Bounce Rate</p>
                </div>
                <div class="level-right">
                  <p class="level-item is-bold"><%= listing_info.alexa.engagement.bounceRate || "-" %></p>
                </div>
              </nav>
              <small class="margin-top-10">
                  For more information, visit <a title="Link to respective Alexa website" target="_blank" class='is-accent' href="http://www.alexa.com/siteinfo/<%= listing_info.domain_name %>">Alexa.com</a>
              </small>
            </div>
            <% if (listing_info.categories) { %>
            <div class="content listing-info">
              <h3 class="is-bold margin-bottom-15">Categories</h3>
              <div class="is-flex-wrap">
                <% var categories_array = listing_info.categories.split(" ")
                for (var i = 0; i < categories_array.length; i++) { %>
                     <span class="tag is-accent"><%= categories_array[i].charAt(0).toUpperCase() + categories_array[i].substr(1); %></span>
              <% } %>
            </div>
            </div>
            <% } %>
            <% if (listing_info.date_created) { %>
                <div class="content listing-info">
                    <h3 class="is-bold margin-bottom-15">Date Listed</h3>
                    <p class="is-flex-wrap" id="date_created"></p>
                </div>
            <% } %>
            <div class="content">
              <% if (listing_info.owner_id){ %>
                  <h3 class="is-bold margin-bottom-15">Listed By</h3>
              <% } else { %>
                  <h3 class="is-bold margin-bottom-15">Owned By</h3>
              <% } %>
              <article class="media">
                <figure class="media-left">
                  <p class="image is-circle is-64x64">
                    <% if (listing_info.profile_pic){ %>
                      <img src="<%= listing_info.profile_pic %>">
                    <% } else { %>
                      <%- "<img src='https://placeholdit.imgix.net/~text?txtsize=25&bg=9e9e9e&txtclr=ffffff&txt=" + listing_info.username + "&w=128&h=128'/>" %>
                    <% } %>
                  </p>
                </figure>
                <div class="media-content">
                  <div class="content">
                    <h3><%= listing_info.username %></h3>
                    <% if (listing_info.user_created) { %>
                      <p>
                        User since <span id='user-since'></span>
                      </p>
                    <% } %>
                  </div>
                </div>
              </article>
            </div>
          </div>
          <footer class="card-footer">
              <a id="less-info-button" tabindex="1" class="card-footer-item has-icon is-hidden">
                  <span>Hide Listing Details</span>
                  <span class="icon is-small">
                      <i class="fa fa-angle-up"></i>
                  </span>
              </a>
          </footer>
        </div>
      </div>
    </div>
  </div>
</section>
