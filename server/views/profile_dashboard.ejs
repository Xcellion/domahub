<!-- user profile page, should not see unless logged in -->

<!DOCTYPE html>

<html>

	<head>
		<title>w3bbi</title>
		<%- include("templates/head_links"); %>
		<link rel="stylesheet" href="/css/profile.css" type="text/css" />
		<script src="/js/moment/moment.min.js" type="text/javascript"></script>
		<script type="text/javascript">
			//redirect to homepage if user is not defined
			var user = <% if(typeof user != "undefined"){ %><%-JSON.stringify(user)%><% }else{ %>window.location="/"<% } %>;
			var listings = <% if(typeof listings != "undefined"){ %><%-JSON.stringify(listings)%><% }else{ %>""<% } %>;
			var rentals = <% if(typeof rentals != "undefined"){ %><%-JSON.stringify(rentals)%><% }else{ %>""<% } %>;
		</script>
	</head>

<body>

	<%- include("templates/navbar", {user: user}); %>

	<div class="container clear-nav">
		<div class="tabs is-centered">
		  <ul>
		    <li class="is-active"><a href="/profile/dashboard">Dashboard</a></li>
		    <li><a href="/profile/inbox">Inbox</a></li>
		    <li><a href="/profile/mylistings">My Listings</a></li>
		    <li><a href="/profile/myrentals">My Rentals</a></li>
		    <li><a href="/profile/settings">Account Settings</a></li>
		  </ul>
		</div>
	</div>

	<section class="section">
		<div class="container">
			<div class="columns">

				<div class="column is-one-quarter">
					<div class="card bottom-margin-25">
						<div class="card-image">
							<figure class="image is-4by3">
								<img src="https://goo.gl/XilFJ5" />
							</figure>
						</div>
						<div class="card-content">
							<h2 class="has-text-centered"><%= user.fullname %></h2>
							<h3 class="has-text-centered"><%= user.email %></h3>
						</div>

						<footer class="card-footer">
							<a class="card-footer-item" href="/profile/settings">Edit Profile</a>
						</footer>
					</div>
					<article class="message bottom-margin-25">
						<div class="message-header has-text-centered">
							Account Settings
						</div>
						<div class="message-body has-text-centered">
							<div class="content quick-links">
								<a>Manage Payments</a>
								<a>Add Account Verification</a>
								<a>Change Email Address</a>
							</div>
						</div>
					</article>
					<article class="message">
						<div class="message-header has-text-centered">
							Quick Links
						</div>
						<div class="message-body has-text-centered">
							<div class="content quick-links">
								<a>FAQ</a>
								<a>Terms of Service</a>
								<a>Privacy Policy</a>
								<a>Support Center</a>
							</div>
						</div>
					</article>
				</div>

				<div class="column is-half">
					<article class="message is-primary">
					  <div class="message-header">
					    Welcome to your dashboard
					  </div>
					  <div class="message-body">
								The dashboard is your control panel to w3bbi -
								from here you can edit your profile, check your private messages,
								and manage your listings, bids, and rentals.
					  </div>
					</article>
					<% if (user.type == 0){ %>
						<div class="notification is-danger">
							<button class="delete"></button>
							<p id="verify-message">
								Please verify your account! Click <a id="verify-link" href="#">here</a> to resend the verification email.
							</p>
						</div>
					<% } %>
					<box class="box">
						<table id="domain_table" class="table">
							<caption class="caption">
								My Listings
							</caption>
							<% if (listings.length){ %>
							<thead>
								<tr>
									<th>Domain Name</th>
									<th>Status</th>
								</tr>
							</thead>
							<tbody>
								<% listings.forEach(function (listing) { %>
								 <tr>
									 <td><a href="/listing/<%= listing.domain_name %>"><%= listing.domain_name %></a></td>
									 <% if (listing.price_type != 0) { %>
										 <td>Active</td>
									 <% } else { %>
										 <td><a href="#">Verify?</a></td>
									 <% } %>
								 </tr>
								<% }) %>
							</tbody>
							<% } %>
						</table>

						<% if (!listings.length) { %>
							<div class="column has-text-centered">
								You have no listings yet!
							</div>
						<% } %>

						<a class="button" href="/listing/create">Create new listing</a>
					</box>
					<div class="box">
						<table id="rental_table" class="table">
							<caption class="caption">
								My Rentals
							</caption>
							<% if (rentals.length){ %>
							<thead>
								<tr>
									<th>Domain Name</th>
									<th>Start Date</th>
									<th>End Date</th>
									<th></th>
								</tr>
							</thead>
							<% } %>
						</table>

						<% if (!rentals.length) { %>
							<div class="column has-text-centered">
								You have no rentals yet!
							</div>
						<% } %>

					</div>
				</div>

				<div class="column is-one-quarter">
					<article class="message">
						<div class="message-body has-text-centered">
							<div class="content">
								<p>
									Your profile is only 50% complete.
								</p>
								<progress class="progress is-warning" value="50" max="100"></progress>
								<a class="button">Complete Now</a>
							</div>
						</div>
					</article>
					<article class="message">
						<div class="message-body has-text-centered">
							<div class="content">
								<p>
									As a domain owner, you must connect your account with <a href="https://stripe.com/about">Stripe</a> before you can receive payments.
								</p>
								<a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=ca_997O55c2IqFxXDmgI9B0WhmpPgoh28s3&scope=read_write" class="button">Connect with Stripe</a>
							</div>
						</div>
					</article>
				</div>

			</div>
		</div>

	</section>

	<%- include("templates/footer"); %>
	<script src="/js/routes/profile_logic.js" type="text/javascript"></script>
	</body>

</html>
